# ìƒê°€ë¥¼ ì°¾ì„ë•Œ? ìƒê°€ë°©ê°€!
ìƒê°€ ì „ìš© ë¶€ë™ì‚° ì¤‘ê°œ ì•±ì…ë‹ˆë‹¤. <br>
- ì‹¤ì‹œê°„ìœ¼ë¡œ ì—…ë°ì´íŠ¸ë˜ëŠ” ìƒê°€ ë§¤ë¬¼! <br>
- ì§€ë„ë¥¼ í†µí•´ ë‚´ ìœ„ì¹˜ ì£¼ë³€ ë§¤ë¬¼ì„ í•œ ëˆˆì— ë³¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤. <br>
- ê²°ì œ ê¸°ëŠ¥ì„ í†µí•´ ê³„ì•½ê¸ˆì„ ë°”ë¡œ ê²°ì œí•˜ì‹¤ ìˆ˜ ìˆìŠµë‹ˆë‹¤. <br>
- ì¢‹ì•„ìš” ëˆ„ë¥¸ ê¸€, ë‚´ê°€ ì‘ì„±í•œ ê¸€, ê³„ì•½ê¸ˆì„ ê²°ì œí•œ ê¸€ì„ ê´€ë¦¬í•˜ì‹¤ ìˆ˜ ìˆìŠµë‹ˆë‹¤. <br>
<br>

## ğŸ“±ìŠ¤í¬ë¦°ìƒ·
<img src="https://github.com/thekoon0456/SangGaBangGa/assets/106993057/16b60e03-f68c-4d49-b02e-600108fb8b86" width="150"></img>
<img src="https://github.com/thekoon0456/SangGaBangGa/assets/106993057/37fc4767-5bae-423c-a13d-d0e3fff15ddd" width="150"></img>
<img src="https://github.com/thekoon0456/SangGaBangGa/assets/106993057/5f2379c2-ee4e-4f54-b606-667ac9cc2217" width="150"></img>
<img src="https://github.com/thekoon0456/SangGaBangGa/assets/106993057/77c36456-df23-4ac1-a680-c11791703b1e" width="150"></img>
<img src="https://github.com/thekoon0456/SangGaBangGa/assets/106993057/5f6afb0a-405c-4a8d-a06b-601c6a99a2df" width="150"></img>

## ğŸ“Œ ì£¼ìš” ê¸°ëŠ¥
- ì´ë©”ì¼ íšŒì›ê°€ì…, ë¡œê·¸ì¸ ê¸°ëŠ¥ <br>
- ì‹¤ì‹œê°„ìœ¼ë¡œ ì—…ë°ì´íŠ¸ë˜ëŠ” ê²Œì‹œê¸€ <br>
- ì¢‹ì•„ìš”, ëŒ“ê¸€ ê¸°ëŠ¥ <br>
- ê¸€ ì‘ì„±ì ì „í™”, ë¬¸ì ê¸°ëŠ¥ <br>
- ì§€ë„ë¥¼ í†µí•´ ì£¼ë³€ ë§¤ë¬¼ ê´€ë¦¬ì™€ ê²€ìƒ‰ê¸°ëŠ¥ <br>
<br>

## ê¸°ìˆ  ìŠ¤íƒ
- UIKit, MVVM-C, Input-Output, Singleton, Repository, CodeBasedUI
- RxSwift, RxMoya, NWPathMonitor, RxGesture ,iamport-ios
- MapKit, CoreLocation, MessageUI
- CompositionalLayout, CollectionViewPagingLayout, DiffableDataSource,
- Kingfisher, SnapKit, IQKeyboardManagerSwift, MarqueeLabel
<br>

## ğŸ“±ì‹œì—° ì˜ìƒ

## ğŸ’» ì•± ê°œë°œ í™˜ê²½

- ìµœì†Œ ì§€ì› ë²„ì „: iOS 16.0+
- Xcode Version 15.0.0
- iPhone SE3 ~ iPhone 15 Pro Max ì „ ê¸°ì¢… í˜¸í™˜ ê°€ëŠ¥
<br>

## ğŸ’¡ ê¸°ìˆ  ì†Œê°œ

### MVVM
- ë·°ì˜ ë¡œì§ê³¼ ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ì„ ë¶„ë¦¬í•˜ê³  ê´€ë¦¬í•˜ê¸° ìœ„í•´ MVVM ì•„í‚¤í…ì²˜ë¥¼ ë„ì…
- Input, Output íŒ¨í„´ì„ í™œìš©í•´ ë·°ì˜ ì´ë²¤íŠ¸ë“¤ì„ Inputì— ë°”ì¸ë”©í•˜ê³ , ë·°ì— ë³´ì—¬ì§ˆ ë°ì´í„°ë¥¼ Outputì— ë°”ì¸ë”©
- ë°ì´í„°ì˜ íë¦„ì„ ë‹¨ë°©í–¥ìœ¼ë¡œ êµ¬ì„±í•˜ê³  ë·°ëª¨ë¸ì˜ ì½”ë“œ ê°€ë…ì„± í–¥ìƒ
- ViewModel Protocolì„ í™œìš©í•´ êµ¬ì¡°ì í™”ëœ ë·°ëª¨ë¸ êµ¬ì„±
<br>

### Coordinator íŒ¨í„´
- CodeBasedUIë¡œ UIêµ¬ì„±, Storyboardì— ë¹„í•´ í™”ë©´ ì „í™˜ì˜ íë¦„ì„ ì§ê´€ì ìœ¼ë¡œ íŒŒì•…í•˜ê¸° í˜ë“  ë‹¨ì 
- í™”ë©´ ì „í™˜ ì½”ë“œê°€ ë³µì¡í•´ì§€ê³  ë¹„ëŒ€í•´ì§€ëŠ” ë¬¸ì œë¥¼ í•´ê²°í•˜ê¸° ìœ„í•´ ë·° ì»¨íŠ¸ë¡¤ëŸ¬ì™€ í™”ë©´ ì „í™˜ ë¡œì§ì„ ë¶„ë¦¬í•´ì„œ ê´€ë¦¬
- Coordinator ìƒì„±, Repository ìƒì„±, ViewModel ìƒì„±, ViewController ìƒì„±í•˜ëŠ” íŒ¨í„´ìœ¼ë¡œ ì˜ì¡´ì„± ì£¼ì…
- ViewControllerì˜ Inputì´ ViewModelì˜ Coordinatorë¡œ ì „ë‹¬í•˜ì—¬ í™”ë©´ ì „í™˜
<br>

### RxSwift
- RxSwiftë¥¼ í™œìš©í•´ ì•± ë‚´ì˜ ì¼ê´€ì„± ìˆëŠ” ë¹„ë™ê¸° ì²˜ë¦¬
- ì—°ì†ëœ escaping closureë¥¼ í”¼í•˜ê³ , ì„ ì–¸í˜• í”„ë¡œê·¸ë˜ë°ì„ í†µí•œ ì½”ë“œ ê°€ë…ì„±ì„ ë†’ì„
- Traitsì„ í™œìš©í•´ ì¼ê´€ëœ Thread ê´€ë¦¬
- ë°ì´í„°ê°€ ë°œìƒí•˜ëŠ” ì‹œì ì—ì„œë¶€í„° ë·°ì— ê·¸ë ¤ì§€ê¸°ê¹Œì§€ í•˜ë‚˜ì˜ ìŠ¤íŠ¸ë¦¼ìœ¼ë¡œ ë°ì´í„° ë°”ì¸ë”©
<br>

### RxMoya
- ë‹¤ì–‘í•œ ì—­í• ì˜ APIë¥¼ RouteríŒ¨í„´ê³¼ RxSwiftë¥¼ ì—°ë™í•´ ê´€ë¦¬í•˜ê¸° ìœ„í•´ RxMoya í™œìš©
- UserRouter, PostsRouter, PaymentRouterë“± ì„¸ë¶„í™”í•œ ì—­í• ì˜ Routerë¥¼ TargetTypeì„ í†µí•´ êµ¬í˜„
- APIì— í•„ìš”í•œ Request, Response ëª¨ë¸ì„ êµ¬ì„±í•˜ê³  Entityë¡œ ë³€í™˜í•´ ì•± ë‚´ì—ì„œ ë°ì´í„° í™œìš©
- RequestInterceptorë¥¼ í™œìš©í•´ Login Token Refresh ê´€ë¦¬
<br>

### Repopsitory íŒ¨í„´
- Repository íŒ¨í„´ì„ ì‚¬ìš©í•´ ë°ì´í„° ê³„ì¸µ ì¶”ìƒí™”
- DIPë¥¼ í™œìš©í•´ Repositoryì˜ ì˜ì¡´ì„± ì—­ì „, ê²°í•©ì„±ì„ ë‚®ì¶”ê³  ìœ ì§€ë³´ìˆ˜ì„± í–¥ìƒ
<br>

### MapKit
- ì‚¬ìš©ìì˜ ìœ„ì¹˜ íŒŒì•…ì„ ìœ„í•´ CLLocationì„ ê¸°ë°˜ìœ¼ë¡œ LocationManager ê´€ë¦¬
- CustomAnnotationViewë¥¼ í™œìš©í•´ ì§€ë„ì— ì›í•˜ëŠ” í™”ë©´ í‘œì‹œ
- CLGeocoderë¥¼ í™œìš©í•˜ì—¬ ì£¼ì†Œì™€ ì¢Œí‘œ ë³€í™˜í•´ ì—°ë™
<br>

### ModernCollectionView
- UICollectionView CompositionalLayoutí™œìš©í•´ Layout êµ¬í˜„
- DiffableDataSourceí™œìš©í•´ ë°ì´í„° ë°”ì¸ë”©
- RxSwiftì˜ modelSelected ë©”ì„œë“œì™€ ì¶©ëŒí•˜ëŠ” ì´ìŠˆ ë°œìƒ, itemSelectedë¡œ ë³€ê²½
<br>

### iamportë¥¼ í™œìš©í•œ ê²°ì œê¸°ëŠ¥ êµ¬í˜„
- ì‚¬ìš©ìë§ˆë‹¤ ë‹¤ì–‘í•œ ê²°ì œ ìˆ˜ë‹¨ì„ í•œë²ˆì— ê´€ë¦¬í•˜ê¸° ìœ„í•´ iamport í™œìš©
- PaymentsServiceClassë¥¼ êµ¬í˜„í•´ ê²°ì œ ê´€ë¦¬
<br>

### NWPathMonitor
- ë„¤íŠ¸ì›Œí¬ ëª¨ë‹ˆí„°ë§ê³¼ ë„¤íŠ¸ì›Œí¬ ë‹¨ì ˆìƒí™© ê´€ë¦¬
- CustomToastë¥¼ í™œìš©í•´ ì—ëŸ¬ì²˜ë¦¬, ì‚¬ìš©ìì™€ì˜ Interaction ì œê³µ
<br>

## âœ… íŠ¸ëŸ¬ë¸” ìŠˆíŒ…
### ì‚¬ìš©ìì˜ í¸ì˜ë¥¼ ìœ„í•´ AccessToken ê°±ì‹ ì„ í†µí•œ ìë™ ë¡œê·¸ì¸ êµ¬í˜„
<div markdown="1">
ì•±ì„ ì¼¤ë•Œë§ˆë‹¤ ë¡œê·¸ì¸ì„ í•´ì•¼í•˜ëŠ” ë²ˆê±°ë¡œì›€ì„ í•´ì†Œí•˜ê¸° ìœ„í•´ ìë™ ë¡œê·¸ì¸ ê¸°ëŠ¥ ë„ì…<br>
Moyaì˜ RequestInterceptorë¥¼ í†µí•´ RefreshTokenì˜ ë§Œë£Œ ì „ê¹Œì§€ëŠ” AccessTokenì„ ìë™ìœ¼ë¡œ ê°±ì‹ í•˜ë„ë¡ êµ¬í˜„<br>
Coordinatorì™€ errorSubjectë¥¼ êµ¬ë…í•´ RefreshTokenì˜ ê°±ì‹ ì´ ë§Œë£Œë˜ë©´ ë¡œê·¸ì¸ í™”ë©´ìœ¼ë¡œ ì´ë™<br>
<br>

```swift
final class TokenInterceptor: RequestInterceptor {
    ...
    static let refreshSubject = BehaviorSubject<Void>(value: ())
    static let errorSubject = PublishSubject<Void>()
    ...

    func retry(_ request: Request, for session: Session, dueTo error: any Error, completion: @escaping (RetryResult) -> Void) {
        guard let response = request.task?.response as? HTTPURLResponse else { return }
        //ì—‘ì„¸ìŠ¤ í† í° ë§Œë£Œ
        guard response.statusCode == 419 else {
            //loginí™”ë©´ìœ¼ë¡œ
            if response.statusCode == 418 {
                TokenInterceptor.errorSubject.onNext(())
            }
            completion(.doNotRetryWithError(error))
            return
        }

        //ì—‘ì„¸ìŠ¤ í† í° ê°±ì‹ 
        UserAPIManager.shared.refreshToken()
            .subscribe { response in
                UserDefaultsManager.shared.userData.accessToken = response.accessToken
                TokenInterceptor.refreshSubject.onNext(())
            }
            .disposed(by: disposeBag)
        completion(.doNotRetry)
    }
}
```
</div>
<br>

### ê° Cellë§ˆë‹¤ ì¢‹ì•„ìš” ë²„íŠ¼ê³¼ ëŒ“ê¸€ ë²„íŠ¼ì„ ì—°ë™í•˜ëŠ” ë°©ì‹ ë³€ê²½. CellViewModelì„ ìƒì„±í•˜ëŠ” ë°©ì‹ì—ì„œ FeedViewModelë¡œ ë¡œì§ ì´ë™
<div markdown="1">
Main Feedì˜ ê° Cellë§ˆë‹¤ ì¢‹ì•„ìš” ë²„íŠ¼ì´ ëˆŒë¦¬ê±°ë‚˜, ëŒ“ê¸€ ë²„íŠ¼ì´ ëˆŒë ¸ì„ë•Œ UIë³€ê²½, ì„œë²„í†µì‹  ë“±ì˜ ì—­í• ì„ ìˆ˜í–‰<br>
ê¸°ì¡´ì—ëŠ” Cellì— ViewModel ì¸ìŠ¤í„´ìŠ¤ë¥¼ ìƒì„±í•˜ëŠ” ë°©ì‹ìœ¼ë¡œ êµ¬í˜„í–ˆìœ¼ë‚˜, Cellì„ í™”ë©´ì— êµ¬ì„±í• ë•Œë§ˆë‹¤ CellViewModelê³¼ ê´€ë ¨ ì¸ìŠ¤í„´ìŠ¤ë“¤ì´ ìƒì„±ë˜ì–´ ë©”ëª¨ë¦¬ì— ë¹„íš¨ìœ¨ì <br>
ë©”ëª¨ë¦¬ë¥¼ íš¨ìœ¨ì ìœ¼ë¡œ í™œìš©í•˜ê¸° ìœ„í•´ CellViewModelì˜ ë¡œì§ì„ FeedViewModelë¡œ ì´ë™í•˜ê³ , í´ë¡œì €ë¡œ ì™¸ë¶€ì—ì„œ Actionì„ ì£¼ì…í•˜ëŠ” ë°©ì‹ìœ¼ë¡œ ë³€ê²½<br>
ë¶ˆí•„ìš”í•œ ì¸ìŠ¤í„´ìŠ¤ ìƒì„±ì„ ì¤„ì´ê³ , ë·°ëª¨ë¸ì—ì„œ ì¼ê´€ëœ ë¡œì§ ì²˜ë¦¬ êµ¬í˜„<br>
<br>

```swift

// MARK: - MainFeedCell
...
var heartButtonTapped: (() -> Void)?
var commentButtonTapped: (() -> Void)?

 override func prepareForReuse() {
     super.prepareForReuse()
     heartButtonTapped = nil
     commentButtonTapped = nil
 }
...

// MARK: - FeedViewController
...
private func feedCellRegistration() -> UICollectionView.CellRegistration<MainFeedCell, ContentEntity> {
    UICollectionView.CellRegistration { cell, indexPath, itemIdentifier in
        cell.configureCellData(itemIdentifier)
        
        cell.heartButtonTapped = { [weak self] in
            guard let self else { return }
            let isSelected = itemIdentifier.likes.contains(UserDefaultsManager.shared.userData.userID ?? "") ? true : false
            cellHeartButtonSubject.onNext((indexPath.item, isSelected))
        }
        
        cell.commentButtonTapped = { [weak self] in
            guard let self else { return }
            cellCommentButtonSubject.onNext(indexPath.item)
        }
    }
}
...

// MARK: - FeedViewModel
...
input
    .cellCommentButtonTapped
    .throttle(.milliseconds(500), scheduler: MainScheduler.instance)
    .asDriver(onErrorJustReturn: 0)
    .drive(with: self) { owner, index in
        let comments = owner.sortedComments(dataRelay.value[index].comments)
        commentsRelay.accept(comments)
        owner.coordinator?.presentComment(data: dataRelay.value[index],
                                          commentsRelay: commentsRelay)
    }
    .disposed(by: disposeBag)
...
```
</div>
<br>

### ë§¤ë¬¼ì˜ ì£¼ì†Œë¥¼ ì¢Œí‘œë¡œ ë³€í™˜í•´ ì§€ë„ì— í‘œì‹œ
<div markdown="1">
ë§¤ë¬¼ìœ¼ ë“±ë¡í•  ë•Œ ì…ë ¥í•œ ë§¤ë¬¼ì˜ ì£¼ì†Œë¥¼ ì¢Œí‘œë¡œ ë³€í™˜í•´ ì§€ë„ì— ë„ì›Œì£¼ê¸° ìœ„í•´ CLGeocoder ì‚¬ìš©<br>
CustomAnnotationViewë¥¼ êµ¬ì„±í•´ ë§¤ë¬¼ì˜ ì‚¬ì§„, ì •ë³´ì™€ ìœ„ì¹˜ë¥¼ ì§€ë„ì— ë°”ë¡œ í‘œì‹œí•˜ë„ë¡ êµ¬í˜„ <br>
<br>

```swift

// MARK: - MapViewModel
...
input
    .address
    .withUnretained(self)
    .flatMap { owner, value in
        owner.convertAddressToCoordinates(address: value)
            .catchAndReturn("")
    }
    .subscribe { value in
        request.content3 = value
    }
    .disposed(by: disposeBag)
...
func convertAddressToCoordinates(address: String) -> Observable<String> {
    return Observable.create { observer in
        let geocoder = CLGeocoder()
        geocoder.geocodeAddressString(address) { (placemarks, error) in
            if let error = error {
                observer.onError(error)
                return
            }
            
            if let placemark = placemarks?.first, let location = placemark.location {
                observer.onNext("\(location.coordinate.latitude) / \(location.coordinate.longitude)")
                observer.onCompleted()
            } else {
                let error = SSError.LocationError
                observer.onError(error)
            }
        }
        
        return Disposables.create()
    }
}
```
</div>
<br>
